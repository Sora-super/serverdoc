(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{190:function(a,e,t){"use strict";t.r(e);var s=t(6),r=Object(s.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"数据库编程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库编程"}},[a._v("#")]),a._v(" 数据库编程")]),a._v(" "),t("h2",{attrs:{id:"存储过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存储过程"}},[a._v("#")]),a._v(" 存储过程")]),a._v(" "),t("h4",{attrs:{id:"存储过程的基本概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存储过程的基本概念"}},[a._v("#")]),a._v(" 存储过程的基本概念")]),a._v(" "),t("blockquote",[t("p",[a._v("存储过程是一组为了完成某项特定功能的SQL语句集，其实质上就是一段储存在数据库中的代码，它可以由声明式SQL语句和过程式SQL语句组成")])]),a._v(" "),t("p",[a._v("Q: 使用存储过程的优点")]),a._v(" "),t("ol",[t("li",[a._v("可增强SQL语言的功能和灵活性")]),a._v(" "),t("li",[a._v("良好的封装性")]),a._v(" "),t("li",[a._v("高性能")]),a._v(" "),t("li",[a._v("可减少网络流量")]),a._v(" "),t("li",[a._v("储存过程可作为一种安全机制来确保数据库的安全性和数据的完整性")])]),a._v(" "),t("h4",{attrs:{id:"创建存储过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建存储过程"}},[a._v("#")]),a._v(" 创建存储过程")]),a._v(" "),t("blockquote",[t("p",[a._v("因为在mysql中，服务器处理SQL语句默认是以分号作为结束标识")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("delimiter ## // 修改结束符号\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("create procedure sp_name([proc_parameter])\n")])])]),t("blockquote",[t("p",[a._v("proc_parameter语法为 [in|out|inout] param_name type")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("create proceduce sp_update_sex(in cid int,in csex char(1))\nbegin\n    update custom set sex=csex where cid=cust_id;\nend\n")])])]),t("h4",{attrs:{id:"存储过程体"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存储过程体"}},[a._v("#")]),a._v(" 存储过程体")]),a._v(" "),t("ol",[t("li",[a._v("局部变量")])]),a._v(" "),t("blockquote",[t("p",[a._v("用来储存储存过程体重的临时结果，用declare语句声明局部变量")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("declare cid int(10)\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("set")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("set cid=80\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[a._v("select --- into")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("select col_name into var_name\n")])])]),t("blockquote",[t("p",[a._v("返回的结果集只能有一行数据")])]),a._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[a._v("流程控制语句")])]),a._v(" "),t("ul",[t("li",[a._v("条件判断语句")])]),a._v(" "),t("blockquote",[t("p",[a._v("id--then--else")])]),a._v(" "),t("ul",[t("li",[a._v("循环语句")])]),a._v(" "),t("blockquote",[t("p",[a._v("while --do--end while\nrepeat--until--end repeat\nloop---end loop")])]),a._v(" "),t("ol",{attrs:{start:"5"}},[t("li",[a._v("游标")])]),a._v(" "),t("blockquote",[t("p",[a._v("解决select--into返回的结果集只有一行数据的问题")])]),a._v(" "),t("ul",[t("li",[a._v("声明游标")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("declare cursor_name cursor for state\n")])])]),t("ul",[t("li",[a._v("打开游标")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("open cursor_name\n")])])]),t("ul",[t("li",[a._v("读取数据")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("fetch cursor_name into var_name,var_id\n")])])]),t("ul",[t("li",[a._v("关闭游标")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("close cursor_name\n")])])]),t("h4",{attrs:{id:"调用存储过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调用存储过程"}},[a._v("#")]),a._v(" 调用存储过程")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("call sp_update_sex(808.'m')\n")])])]),t("h4",{attrs:{id:"删除存储过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除存储过程"}},[a._v("#")]),a._v(" 删除存储过程")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("drop procedure sp_name\n")])])]),t("hr"),a._v(" "),t("h2",{attrs:{id:"存储函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存储函数"}},[a._v("#")]),a._v(" 存储函数")]),a._v(" "),t("ol",[t("li",[a._v("存储函数不能拥有输出函数，这是因为存储函数自身就是输出含参数；而存储过程可以拥有输出参数")]),a._v(" "),t("li",[a._v("可以直接用存储函数进行调用，且不需要使用call语句，而对存储过程的调用需要使用call语句")]),a._v(" "),t("li",[a._v("存储函数中必须包含一条return 语句，而这条特殊的SQL语句不允许包含于存储过程中")])]),a._v(" "),t("h4",{attrs:{id:"创建存储函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建存储函数"}},[a._v("#")]),a._v(" 创建存储函数")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("create funcion sp_name returns types routine_body\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("Q: 在数据库test创建一个存储函数，需求改函数能根据给定的客户id返回客户的性别，如果数据库没有给定的客户id，则返回没有该客户\n\ndelimiter ##\ncreate function search(cid int)\nreturns char(2)\ndeterminstic\nbegin \ndeclare sex char(1);\nselect sex into sex from test\nwhere cust_id=cid;\nid sex is null then\nreturn(select '没有该客户');\nelse if sex='f' then\nreturn(select '女');\nelse return(select '男');\nend if;\nend if;\nend ##\n")])])]),t("h4",{attrs:{id:"调用存储函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调用存储函数"}},[a._v("#")]),a._v(" 调用存储函数")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("select sp_name(90)\n")])])]),t("h4",{attrs:{id:"删除存储函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除存储函数"}},[a._v("#")]),a._v(" 删除存储函数")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("drop function if exists search; \n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);