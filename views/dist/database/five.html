<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据库安全与保护 | Hello</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Hello, my friend!">
    <link rel="preload" href="/assets/css/0.styles.ae176247.css" as="style"><link rel="preload" href="/assets/js/app.5c3fdab4.js" as="script"><link rel="preload" href="/assets/js/2.705226bb.js" as="script"><link rel="preload" href="/assets/js/7.1fcc9cfb.js" as="script"><link rel="prefetch" href="/assets/js/10.9e439d68.js"><link rel="prefetch" href="/assets/js/11.1b226cf0.js"><link rel="prefetch" href="/assets/js/12.38c3b1a6.js"><link rel="prefetch" href="/assets/js/13.a998d9ed.js"><link rel="prefetch" href="/assets/js/14.4f605fae.js"><link rel="prefetch" href="/assets/js/15.43db0993.js"><link rel="prefetch" href="/assets/js/16.e45c2030.js"><link rel="prefetch" href="/assets/js/17.a7e9dce6.js"><link rel="prefetch" href="/assets/js/18.d1a6cc65.js"><link rel="prefetch" href="/assets/js/19.ee757549.js"><link rel="prefetch" href="/assets/js/20.f06f02a7.js"><link rel="prefetch" href="/assets/js/21.9931a980.js"><link rel="prefetch" href="/assets/js/22.b989ae5f.js"><link rel="prefetch" href="/assets/js/23.79763f37.js"><link rel="prefetch" href="/assets/js/24.887cb6da.js"><link rel="prefetch" href="/assets/js/25.dbd217cc.js"><link rel="prefetch" href="/assets/js/26.a2659ee0.js"><link rel="prefetch" href="/assets/js/27.6ccce6b0.js"><link rel="prefetch" href="/assets/js/28.4ee59414.js"><link rel="prefetch" href="/assets/js/29.3483a828.js"><link rel="prefetch" href="/assets/js/3.e7736b8e.js"><link rel="prefetch" href="/assets/js/4.7498c97f.js"><link rel="prefetch" href="/assets/js/5.bfe097fd.js"><link rel="prefetch" href="/assets/js/6.14afed8d.js"><link rel="prefetch" href="/assets/js/8.2a528e12.js"><link rel="prefetch" href="/assets/js/9.f23dc594.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ae176247.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hello</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/swiper/" class="nav-link">
  Swiper
</a></div><div class="nav-item"><a href="/database/" class="nav-link router-link-active">
  Database
</a></div><div class="nav-item"><a href="/vueskill/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="http://www.xuezsl.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/swiper/" class="nav-link">
  Swiper
</a></div><div class="nav-item"><a href="/database/" class="nav-link router-link-active">
  Database
</a></div><div class="nav-item"><a href="/vueskill/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="http://www.xuezsl.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>数据库系统原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/" aria-current="page" class="sidebar-link">数据库系统概述</a></li><li><a href="/database/one.html" class="sidebar-link">关系数据库</a></li><li><a href="/database/two.html" class="sidebar-link">数据库设计</a></li><li><a href="/database/three.html" class="sidebar-link">SQL与关系数据库基本操作</a></li><li><a href="/database/four.html" class="sidebar-link">数据库编程</a></li><li><a href="/database/five.html" aria-current="page" class="active sidebar-link">数据库安全与保护</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/five.html#数据库完整性" class="sidebar-link">数据库完整性</a></li><li class="sidebar-sub-header"><a href="/database/five.html#触发器" class="sidebar-link">触发器</a></li><li class="sidebar-sub-header"><a href="/database/five.html#安全性与访问控制" class="sidebar-link">安全性与访问控制</a></li><li class="sidebar-sub-header"><a href="/database/five.html#事务与并发控制" class="sidebar-link">事务与并发控制</a></li><li class="sidebar-sub-header"><a href="/database/five.html#备份与恢复" class="sidebar-link">备份与恢复</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="数据库安全与保护"><a href="#数据库安全与保护" class="header-anchor">#</a> 数据库安全与保护</h1> <h2 id="数据库完整性"><a href="#数据库完整性" class="header-anchor">#</a> 数据库完整性</h2> <h4 id="完整性约束条件的作用对象"><a href="#完整性约束条件的作用对象" class="header-anchor">#</a> 完整性约束条件的作用对象</h4> <ul><li>列级约束</li></ul> <div class="language- extra-class"><pre class="language-text"><code>主要指对列的类型、取值范围、精度等的约束
</code></pre></div><ul><li>元组约束</li></ul> <div class="language- extra-class"><pre class="language-text"><code>元组中各个字段之间的相互约束
</code></pre></div><ul><li>表级约束</li></ul> <div class="language- extra-class"><pre class="language-text"><code>若干元组之间、关系之间的联系的约束
</code></pre></div><h4 id="定义与实现完整性约束"><a href="#定义与实现完整性约束" class="header-anchor">#</a> 定义与实现完整性约束</h4> <ol><li>实体完整性</li></ol> <ul><li>主键约束</li> <li>候选键约束
<ul><li>一个表中只能创建一个主键，但可以定义若干个候选键</li> <li>定义主键约束时，系统会自动产生primary key索引，而定义候选键约束时，系统会总动产生unique索引</li></ul></li></ul> <ol start="2"><li>参照完整性</li></ol> <blockquote><p>主要是指二个表之间的关系</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>references customer(cust_id) on delete restrict
</code></pre></div><ol start="3"><li>用户定义的完整性</li></ol> <ul><li>非空约束</li></ul> <blockquote><p>not null</p></blockquote> <ul><li>check约束</li></ul> <blockquote><p>check(expr)</p></blockquote> <h4 id="命名完整性约束"><a href="#命名完整性约束" class="header-anchor">#</a> 命名完整性约束</h4> <blockquote><p>constraint(symbol) //symbol在数据库中必须是唯一的</p></blockquote> <h4 id="更新完整性约束"><a href="#更新完整性约束" class="header-anchor">#</a> 更新完整性约束</h4> <blockquote><p>可在alter table 语句中使用add constraint</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>alter table custom drop primary key

alter table custom drop foreign ket [外键约束名]
</code></pre></div><hr> <h2 id="触发器"><a href="#触发器" class="header-anchor">#</a> 触发器</h2> <h4 id="创建触发器"><a href="#创建触发器" class="header-anchor">#</a> 创建触发器</h4> <div class="language- extra-class"><pre class="language-text"><code>create trigger trigger_name trigger_time trigger_event on tab_name for
each row trigger_body
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>Q: 在数据库test表custom中创建一个触发器custom_trigger，用于每次向表
custom插入一行数据时，将用户变量str的值设置为‘one customer add’


create trigger custom_trigger after insert on custom for each row
set str @str='one customer add'
</code></pre></div><h4 id="删除触发器"><a href="#删除触发器" class="header-anchor">#</a> 删除触发器</h4> <div class="language- extra-class"><pre class="language-text"><code>drop trigger_name
</code></pre></div><h4 id="使用触发器"><a href="#使用触发器" class="header-anchor">#</a> 使用触发器</h4> <ul><li>insert触发器</li> <li>update触发器</li> <li>delete触发器</li></ul> <hr> <h2 id="安全性与访问控制"><a href="#安全性与访问控制" class="header-anchor">#</a> 安全性与访问控制</h2> <h4 id="用户账号管理"><a href="#用户账号管理" class="header-anchor">#</a> 用户账号管理</h4> <ol><li>创建用户账号</li></ol> <div class="language- extra-class"><pre class="language-text"><code>create user 'zhangsan'@'localhost' identified by '123'
</code></pre></div><ol start="2"><li>删除用户</li></ol> <div class="language- extra-class"><pre class="language-text"><code>drop user lisi 
</code></pre></div><blockquote><p>必须拥有数据库的delete权限或全局create user权限</p></blockquote> <ol start="3"><li>修改用户账号</li></ol> <div class="language- extra-class"><pre class="language-text"><code>rename user 'zhangsan'@'localhost' to 'wangwu'@'localhost'
</code></pre></div><blockquote><p>必须拥有数据库的update权限或全局create user权限</p></blockquote> <ol start="4"><li>修改用户口令</li></ol> <div class="language- extra-class"><pre class="language-text"><code>set password for 'wangwu'@'localhost'='123123123123'
</code></pre></div><h4 id="账户权限管理"><a href="#账户权限管理" class="header-anchor">#</a> 账户权限管理</h4> <ol><li>权限的授予</li></ol> <div class="language- extra-class"><pre class="language-text"><code>grant all on mysql to 'wangwu'@'localhost'
</code></pre></div><ol start="2"><li>权限的转移</li></ol> <div class="language- extra-class"><pre class="language-text"><code>Q： 授予当前系统中一个不存在的用于zhou在数据库mysql表上所有的权限，
并且允许将自身的权限授予其他用户

grant all on mysql to 'zhou'@'localhost' identified by '123' with grant option
</code></pre></div><ol start="3"><li>权限的撤销</li></ol> <div class="language- extra-class"><pre class="language-text"><code>revoke all on mysql from 'zhou'@'localhost'
</code></pre></div><hr> <h2 id="事务与并发控制"><a href="#事务与并发控制" class="header-anchor">#</a> 事务与并发控制</h2> <h4 id="事务的概念"><a href="#事务的概念" class="header-anchor">#</a> 事务的概念</h4> <blockquote><p>是用户定义的一个数据操作序列，要么全部执行，要么全部不执行，事务与程序是二个概念</p></blockquote> <h4 id="事务的特征"><a href="#事务的特征" class="header-anchor">#</a> 事务的特征</h4> <ul><li>原子性(Atomicity)</li> <li>一致性(Consistency)</li> <li>隔离性(Isolation)</li> <li>持续性(Durability)</li></ul> <h4 id="并发操作问题"><a href="#并发操作问题" class="header-anchor">#</a> 并发操作问题</h4> <ol><li>丢失更新</li> <li>不可重复读</li> <li>读‘脏’数据</li></ol> <h4 id="封锁"><a href="#封锁" class="header-anchor">#</a> 封锁</h4> <blockquote><p>需要时，事务通过向系统请求对它所希望的数据对象加锁，以确保它不被非预期改变</p></blockquote> <ol><li>锁</li></ol> <blockquote><p>一个锁实质上就是允许或阻止一个事务对一个数据对象的存取特权。基本的封锁类型有二种：排它锁(Exclusive Lock,X锁)、共享锁(Shared Lock,S锁)</p></blockquote> <ol start="2"><li>用封锁进行并发控制</li></ol> <ul><li>若事务T对数据D加了X锁，则所有别的事务对数据D的锁请求都必须等待直到事务T释放锁</li> <li>若事务T对数据D加了S锁，则别的事务还可对数据D请求S锁，而对数据D的X锁请求必须等待直到事务T释放锁</li> <li>事务执行数据库操作都要先请求对应的锁，即对读请求S锁，对更新、插入、删除请求X锁</li> <li>事务一直占有获得的锁直到结束时释放</li></ul> <ol start="3"><li>封锁的粒度</li></ol> <blockquote><p>通常以粒度来描述封锁的数据单元大小，DBMS可以决定不同粒度的锁，由最底层的数据元素到最高层的整个数据库，粒度越细，并发性越大，但软件复杂性和系统开销也就越大</p></blockquote> <ol start="4"><li>封锁的级别</li></ol> <ul><li>0级封锁</li></ul> <blockquote><p>封锁的事务不重写其他非0级封锁事务的未提交的更新数据</p></blockquote> <ul><li>1级封锁</li></ul> <blockquote><p>被封锁的事务不允许重写未提交的更新数据。这防止了丢失更新的发生</p></blockquote> <ul><li>2级封锁</li></ul> <blockquote><p>被封锁的事务即不重写也不读未提交的更新数据，这出了1级封锁效果还防止了读脏数据</p></blockquote> <ul><li>3级封锁</li></ul> <blockquote><p>被封锁的事务不读未提交的更新数据，不写任何未提交的数据</p></blockquote> <ol start="5"><li>活锁与死锁</li></ol> <ul><li>活锁</li></ul> <blockquote><p>由于锁会使一个事务处于等待状态而调度其他事务处理，因而该事务可能会因优先级别低而永远等待下去
解决方法： 先来先服务</p></blockquote> <ul><li>死锁</li></ul> <blockquote><p>一次性锁请求。锁请求排序。序列化处理。资源剥夺</p></blockquote> <ol start="6"><li>可串行性</li></ol> <blockquote><p>一组事务的一个调度就是它们的基本操作的一种排序。可串行性就是并发执行的正确性准则，即当且仅当一组事务的并发执行调度是可串行化的，才认为它是正确的</p></blockquote> <ol start="7"><li>二段封锁法</li></ol> <ul><li>发展或加锁阶段</li> <li>收缩或释放锁阶段</li></ul> <blockquote><p>遵循二段锁协议的事务的任何并发调度都是可串行化的</p></blockquote> <hr> <h2 id="备份与恢复"><a href="#备份与恢复" class="header-anchor">#</a> 备份与恢复</h2> <p>Q: 数据丢失或被破坏可能的原因</p> <div class="language- extra-class"><pre class="language-text"><code>1. 计算机硬件故障
2. 计算机软件故障
3. 病毒
4. 自然灾害
5. 人为误操作
6. 盗窃
</code></pre></div><blockquote><p>不足：只能导出或导入数据的内容，而不包括表的结构，如果表的结构文件损坏，必须设法先恢复原表结构</p></blockquote> <h4 id="select-into-outfile"><a href="#select-into-outfile" class="header-anchor">#</a> select into--outfile</h4> <div class="language- extra-class"><pre class="language-text"><code>select * into outfile 'file_name' export_options
</code></pre></div><h4 id="load-data-intfile"><a href="#load-data-intfile" class="header-anchor">#</a> load data--intfile</h4> <div class="language- extra-class"><pre class="language-text"><code>
Q： 备份表mysql的全部数据到c/backup/back,txt中，要求字段值如果是字符则用双引号标注，
每行以‘？’结束

select * from mysql
into outfile 'c/backup/back,txt' 
fields terminated by ',' 
optionally enclosed by ''
lines terminated by '?'
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/database/four.html" class="prev">
        数据库编程
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5c3fdab4.js" defer></script><script src="/assets/js/2.705226bb.js" defer></script><script src="/assets/js/7.1fcc9cfb.js" defer></script>
  </body>
</html>
